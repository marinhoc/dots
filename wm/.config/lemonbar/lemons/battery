#!/usr/bin/env bash

while IFS=: read -r -a chunks; do
    charging=0

    ((var = 0))

    for chunk in "${chunks[@]}"; do
        IFS=' ' read -r _ charge status <<< $chunk

        [[ $status == Charging ]] &&
            charging=1

        ((var += charge))
    done

    ((var /= ${#chunks[@]}))

    case $charging in
        1)
            icon=
            ;;
        0)
            case $((var / 25)) in
                0) icon=;;
                1) icon=;;
                2) icon=;;
                3) icon=;;
                *) icon=
            esac
    esac

    printf '%s\n' "bat $icon%{O10}$var%%"
done < <(battery)
